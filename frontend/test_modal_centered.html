<!DOCTYPE html>
<html>
<head>
    <title>Test Modal Centrato</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: #f5f5f5;
            height: 100vh;
        }
        
        .test-button {
            padding: 15px 30px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
        
        /* Modal Styles - Centrato con overlay */
        .admin-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            display: none;
            background: rgba(0, 0, 0, 0.5);
        }
        
        .admin-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .admin-modal-content {
            position: relative;
            margin: auto;
            top: 50%;
            transform: translateY(-50%);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .admin-modal-header {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .admin-modal-close {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            font-size: 20px;
        }
        
        .admin-modal-close:hover {
            color: #6b7280;
            background: #f3f4f6;
        }
        
        .admin-modal-body {
            padding: 20px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .test-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .dashboard-simulation {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-height: 400px;
        }
    </style>
</head>
<body>
    <h1>Test Modal Centrato con Overlay</h1>
    
    <div class="test-content">
        <h2>Test del Modal Dettagli Prelievo</h2>
        <p>Questo test simula il comportamento del modal centrato con overlay scuro.</p>
        <button class="test-button" onclick="testModal()">Testa Modal Centrato</button>
        <button class="test-button" onclick="testModalWithData()">Testa Modal con Dati USDT</button>
        <button class="test-button" onclick="testModalWithBankData()">Testa Modal con Dati Bancari</button>
    </div>
    
    <div class="dashboard-simulation">
        <h3>Simulazione Dashboard Admin</h3>
        <p>Questo contenuto simula la dashboard admin. Quando apri il modal, dovrebbe essere oscurato.</p>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
        <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
        <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>
        <p>Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
        <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium.</p>
    </div>

    <!-- Modal per test -->
    <div id="withdrawal-details-modal" class="admin-modal hidden">
        <div class="admin-modal-overlay" onclick="closeModal()"></div>
        <div class="admin-modal-content">
            <div class="admin-modal-header">
                <h3 style="margin: 0; font-size: 18px; font-weight: 600; color: #111827;">Dettagli Prelievo</h3>
                <button onclick="closeModal()" class="admin-modal-close">&times;</button>
            </div>
            <div id="withdrawal-details-content" class="admin-modal-body">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        function testModal() {
            const modal = document.getElementById('withdrawal-details-modal');
            const content = document.getElementById('withdrawal-details-content');
            
            content.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <h4>Modal di Test</h4>
                    <p>Questo modal dovrebbe apparire al centro della pagina.</p>
                    <p>Lo sfondo dovrebbe essere oscurato! ✅</p>
                    <p>Il modal è perfettamente centrato.</p>
                </div>
            `;
            
            showModal();
        }
        
        function testModalWithData() {
            const withdrawal = {
                id: 1,
                full_name: 'Mario Rossi',
                email: 'mario.rossi@example.com',
                amount: 500.00,
                method: 'usdt',
                source_section: 'free_capital',
                unique_key: 'ABC123',
                status: 'pending',
                created_at: new Date().toISOString(),
                hours_pending: 2.5,
                wallet_address: '0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6',
                network: 'ERC20'
            };
            
            showWithdrawalDetailsModal(withdrawal);
        }
        
        function testModalWithBankData() {
            const withdrawal = {
                id: 2,
                full_name: 'Giulia Bianchi',
                email: 'giulia.bianchi@example.com',
                amount: 1000.00,
                method: 'bank',
                source_section: 'free_capital',
                unique_key: 'BANK01',
                status: 'pending',
                created_at: new Date().toISOString(),
                hours_pending: 1.2,
                bank_details: {
                    iban: 'IT60X0542811101000000123456',
                    account_holder: 'Giulia Bianchi',
                    bank_name: 'Banca Popolare di Sondrio'
                }
            };
            
            showWithdrawalDetailsModal(withdrawal);
        }
        
        function showModal() {
            const modal = document.getElementById('withdrawal-details-modal');
            
            // Assicurati che il modal sia posizionato correttamente al centro
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.zIndex = '9999';
            modal.style.background = 'rgba(0, 0, 0, 0.5)';
            
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
        }
        
        function closeModal() {
            const modal = document.getElementById('withdrawal-details-modal');
            modal.classList.add('hidden');
            modal.style.display = 'none';
        }
        
        // Funzione per mostrare i dettagli del prelievo (copiata dal template)
        function showWithdrawalDetailsModal(withdrawal) {
            console.log('showWithdrawalDetailsModal chiamata con:', withdrawal);
            const modal = document.getElementById('withdrawal-details-modal');
            const content = document.getElementById('withdrawal-details-content');
            
            if (!modal || !content) {
                console.error('Modal o content non trovato');
                return;
            }
            
            // Assicurati che il modal sia posizionato correttamente al centro
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.zIndex = '9999';
            modal.style.background = 'rgba(0, 0, 0, 0.5)';
            
            // Dettagli specifici per metodo
            let methodDetails = '';
            if (withdrawal.method === 'usdt') {
                const network = withdrawal.network || 'BEP20';
                const networkLabel = network === 'BEP20' ? 'BSC (BEP20)' : 
                                    network === 'ERC20' ? 'Ethereum (ERC20)' : 
                                    network === 'TRC20' ? 'Tron (TRC20)' : network;
                
                methodDetails = `
                    <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 16px; margin: 16px 0;">
                        <h4 style="color: #1e40af; margin: 0 0 12px 0;">💳 Dettagli USDT</h4>
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="font-weight: 500; color: #1e40af;">Rete:</span>
                                <span style="font-weight: bold; color: #1e3a8a;">${networkLabel}</span>
                            </div>
                            <div>
                                <span style="font-weight: 500; color: #1e40af;">Indirizzo Wallet:</span>
                                <div style="margin-top: 4px; padding: 8px; background: white; border: 1px solid #0ea5e9; border-radius: 4px; font-family: monospace; font-size: 12px; word-break: break-all;">
                                    ${withdrawal.wallet_address}
                                </div>
                                <button onclick="copyToClipboard('${withdrawal.wallet_address}')" style="margin-top: 8px; padding: 4px 8px; background: #0ea5e9; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                                    📋 Copia indirizzo
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                const bankDetails = withdrawal.bank_details || {};
                methodDetails = `
                    <div style="background: #f0fdf4; border: 1px solid #22c55e; border-radius: 8px; padding: 16px; margin: 16px 0;">
                        <h4 style="color: #166534; margin: 0 0 12px 0;">🏦 Dettagli Bancari</h4>
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="font-weight: 500; color: #166534;">IBAN:</span>
                                <span style="font-family: monospace; color: #14532d;">${bankDetails.iban || 'N/A'}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="font-weight: 500; color: #166534;">Intestatario:</span>
                                <span style="font-weight: bold; color: #14532d;">${bankDetails.account_holder || 'N/A'}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="font-weight: 500; color: #166534;">Banca:</span>
                                <span style="color: #14532d;">${bankDetails.bank_name || 'N/A'}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            const contentHTML = `
                <div style="padding: 20px;">
                    <h2 style="margin: 0 0 20px 0; color: #1f2937;">Dettagli Prelievo</h2>
                    
                    <!-- Header con info principali -->
                    <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div>
                                <label style="display: block; font-weight: 500; color: #374151; margin-bottom: 4px;">👤 Utente</label>
                                <p style="margin: 4px 0; font-weight: bold; color: #111827;">${withdrawal.full_name || 'N/A'}</p>
                                <p style="margin: 4px 0; color: #6b7280;">${withdrawal.email || 'N/A'}</p>
                            </div>
                            
                            <div>
                                <label style="display: block; font-weight: 500; color: #374151; margin-bottom: 4px;">💰 Importo</label>
                                <p style="margin: 4px 0; font-size: 18px; font-weight: bold; color: #059669;">€${parseFloat(withdrawal.amount).toLocaleString('it-IT', {minimumFractionDigits: 2})}</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Info prelievo -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                        <div>
                            <label style="display: block; font-weight: 500; color: #374151; margin-bottom: 4px;">📋 Metodo</label>
                            <p style="margin: 4px 0; font-weight: bold; color: #111827;">${withdrawal.method === 'usdt' ? 'USDT' : 'Bonifico Bancario'}</p>
                        </div>
                        
                        <div>
                            <label style="display: block; font-weight: 500; color: #374151; margin-bottom: 4px;">📂 Sezione</label>
                            <p style="margin: 4px 0; font-weight: bold; color: #111827;">${withdrawal.source_section === 'free_capital' ? 'Capitale Libero' : 
                              withdrawal.source_section === 'profits' ? 'Profitti' : 
                              withdrawal.source_section === 'referral_bonus' ? 'Bonus Referral' : withdrawal.source_section}</p>
                        </div>
                    </div>
                    
                    <!-- Chiave unica -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; font-weight: 500; color: #374151; margin-bottom: 4px;">🔑 Chiave Unica</label>
                        <div style="padding: 8px; background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 4px; font-family: monospace; font-size: 14px;">
                            ${withdrawal.unique_key}
                        </div>
                    </div>
                    
                    <!-- Dettagli specifici metodo -->
                    ${methodDetails}
                    
                    <!-- Info temporali -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                        <div>
                            <label style="display: block; font-weight: 500; color: #374151; margin-bottom: 4px;">📅 Data Richiesta</label>
                            <p style="margin: 4px 0; color: #111827;">${new Date(withdrawal.created_at).toLocaleString('it-IT')}</p>
                        </div>
                        
                        <div>
                            <label style="display: block; font-weight: 500; color: #374151; margin-bottom: 4px;">⏱️ Tempo in Attesa</label>
                            <p style="margin: 4px 0; color: #111827;">
                                ${withdrawal.hours_pending ? withdrawal.hours_pending.toFixed(1) + ' ore' : 'N/A'}
                            </p>
                        </div>
                    </div>
                    
                    <!-- Status -->
                    <div>
                        <label style="display: block; font-weight: 500; color: #374151; margin-bottom: 4px;">📊 Stato</label>
                        <span style="display: inline-flex; align-items: center; padding: 4px 12px; border-radius: 9999px; font-size: 12px; font-weight: 500; background: #fef3c7; color: #92400e;">
                            ${withdrawal.status === 'pending' ? 'In Attesa' : 
                              withdrawal.status === 'completed' ? 'Completato' : 
                              withdrawal.status === 'cancelled' ? 'Rifiutato' : withdrawal.status}
                        </span>
                    </div>
                </div>
            `;
            
            content.innerHTML = contentHTML;
            
            console.log('Mostro il modal...');
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            console.log('Modal mostrato, classi:', modal.className);
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                alert('Indirizzo copiato negli appunti!');
            }, function(err) {
                console.error('Errore copia: ', err);
                alert('Errore nella copia');
            });
        }
    </script>
</body>
</html>
