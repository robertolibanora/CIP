{% set ep = request.endpoint or '' %}
<nav class="tabbar" role="navigation" aria-label="Navigazione principale" style="position: fixed !important; bottom: 0 !important; left: 0 !important; right: 0 !important; z-index: 50 !important; background-color: rgba(255, 255, 255, 0.95) !important; backdrop-filter: blur(8px) !important; border-top: 1px solid rgb(229 231 235) !important; padding: 8px 16px 0 !important; padding-bottom: calc(10px + env(safe-area-inset-bottom)) !important; display: flex !important; justify-content: space-between !important; align-items: center !important;">
  <!-- Home -->
  <a href="{{ url_for('user.dashboard') }}"
     class="tabbar-item" 
     style="height: 48px !important; width: 48px !important; display: flex !important; align-items: center !important; justify-content: center !important; border-radius: 12px !important; transition: all 0.2s ease !important; user-select: none !important; {{ 'background-color: rgb(59 130 246) !important; color: white !important; transform: scale(1.05) !important; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3) !important;' if ep == 'user.dashboard' else 'background-color: rgb(249 250 251) !important; border: 1px solid rgb(229 231 235) !important;' }}"
     aria-label="Dashboard"
     aria-current="{{ 'page' if ep == 'user.dashboard' else 'false' }}">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="height: 24px !important; width: 24px !important; {{ 'opacity: 1 !important; color: white !important;' if ep == 'user.dashboard' else 'opacity: 0.9 !important; color: rgb(75 85 99) !important;' }}">
      <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
      <polyline points="9,22 9,12 15,12 15,22"></polyline>
    </svg>
  </a>

  <!-- Search -->
  <a href="{{ url_for('user.search') }}" 
     class="tabbar-item"
     style="height: 48px !important; width: 48px !important; display: flex !important; align-items: center !important; justify-content: center !important; border-radius: 12px !important; transition: all 0.2s ease !important; user-select: none !important; {{ 'background-color: rgb(59 130 246) !important; color: white !important; transform: scale(1.05) !important; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3) !important;' if ep == 'user.search' else 'background-color: rgb(249 250 251) !important; border: 1px solid rgb(229 231 235) !important;' }}"
     aria-label="Cerca progetti"
     aria-current="{{ 'page' if ep == 'user.search' else 'false' }}">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="height: 24px !important; width: 24px !important; {{ 'opacity: 1 !important; color: white !important;' if ep == 'user.search' else 'opacity: 0.9 !important; color: rgb(75 85 99) !important;' }}">
      <circle cx="11" cy="11" r="8"></circle>
      <path d="m21 21-4.35-4.35"></path>
    </svg>
  </a>

  <!-- Referral -->
  <a href="{{ url_for('user.referral_page') }}" 
     class="tabbar-item"
     style="height: 48px !important; width: 48px !important; display: flex !important; align-items: center !important; justify-content: center !important; border-radius: 12px !important; transition: all 0.2s ease !important; user-select: none !important; {{ 'background-color: rgb(59 130 246) !important; color: white !important; transform: scale(1.05) !important; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3) !important;' if ep == 'user.referral_page' else 'background-color: rgb(249 250 251) !important; border: 1px solid rgb(229 231 235) !important;' }}"
     aria-label="Referral"
     aria-current="{{ 'page' if ep == 'user.referral_page' else 'false' }}">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="height: 24px !important; width: 24px !important; {{ 'opacity: 1 !important; color: white !important;' if ep == 'user.referral_page' else 'opacity: 0.9 !important; color: rgb(75 85 99) !important;' }}">
      <path d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
    </svg>
  </a>

  <!-- Portfolio -->
  <a href="{{ url_for('user.portfolio') }}" 
     class="tabbar-item"
     style="height: 48px !important; width: 48px !important; display: flex !important; align-items: center !important; justify-content: center !important; border-radius: 12px !important; transition: all 0.2s ease !important; user-select: none !important; {{ 'background-color: rgb(59 130 246) !important; color: white !important; transform: scale(1.05) !important; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3) !important;' if ep == 'user.portfolio' else 'background-color: rgb(249 250 251) !important; border: 1px solid rgb(229 231 235) !important;' }}"
     aria-label="Portfolio"
     aria-current="{{ 'page' if ep == 'user.portfolio' else 'false' }}">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="height: 24px !important; width: 24px !important; {{ 'opacity: 1 !important; color: white !important;' if ep == 'user.portfolio' else 'opacity: 0.9 !important; color: rgb(75 85 99) !important;' }}">
      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
      <line x1="9" y1="3" x2="9" y2="21"></line>
      <line x1="15" y1="3" x2="15" y2="21"></line>
    </svg>
  </a>

  <!-- Profile -->
  <a href="{{ url_for('user.profile') }}" 
     class="tabbar-item"
     style="height: 48px !important; width: 48px !important; display: flex !important; align-items: center !important; justify-content: center !important; border-radius: 12px !important; transition: all 0.2s ease !important; user-select: none !important; {{ 'background-color: rgb(59 130 246) !important; color: white !important; transform: scale(1.05) !important; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3) !important;' if ep == 'user.profile' else 'background-color: rgb(249 250 251) !important; border: 1px solid rgb(229 231 235) !important;' }}"
     aria-label="Profilo"
     aria-current="{{ 'page' if ep == 'user.profile' else 'false' }}">
    {% if current_user and current_user.avatar_url %}
      <img src="{{ current_user.avatar_url }}" alt="" class="h-6 w-6 rounded-full object-cover" loading="lazy" style="height: 24px !important; width: 24px !important; {{ 'opacity: 1 !important; border: 2px solid white !important;' if ep == 'user.profile' else 'opacity: 0.9 !important; border: 1px solid rgb(229 231 235) !important;' }}">
    {% else %}
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="height: 24px !important; width: 24px !important; {{ 'opacity: 1 !important; color: white !important;' if ep == 'user.profile' else 'opacity: 0.9 !important; color: rgb(75 85 99) !important;' }}">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
    {% endif %}
  </a>
</nav>

<style>
/* CSS per nascondere su desktop */
@media (min-width: 768px) {
  .tabbar {
    display: none !important;
  }
}

/* Spaziatore per contenuti */
.tabbar-spacer {
  height: 64px !important;
}

@media (min-width: 768px) {
  .tabbar-spacer {
    display: none !important;
  }
}

/* Hover effects per le tab non attive */
.tabbar-item:hover {
  transform: scale(1.02) !important;
  background-color: rgb(243 244 246) !important;
}

/* Animazione per le tab attive */
.tabbar-item:active {
  transform: scale(0.98) !important;
}
</style>
